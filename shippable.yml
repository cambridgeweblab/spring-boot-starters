language: java
jdk:
  - oraclejdk8
services:
  - mongodb
env:
  global:
    # AWS_ACCESS_KEY and AWS_SECRET_ACCESS_KEY
build:
  cache: true
  cache_dir_list:
    - $HOME/.m2

  ci:
    - mkdir -p shippable/testresults
    # Can't do any building on a PR because the AWS variables are not available to fetch dependencies
    - if [[ $IS_PULL_REQUEST != true ]]; then mvn --batch-mode clean; fi
    - if [[ $BRANCH == "master" ]] && [[ $IS_PULL_REQUEST != true ]]; then mvn --batch-mode --update-snapshots -Pshippable deploy; fi
    - if [[ $BRANCH != "master" ]] && [[ $IS_PULL_REQUEST != true ]]; then mvn --batch-mode --update-snapshots -Pshippable verify; fi

integrations:
  notifications:
    - integrationName: hipchat
      type: hipchat
      recipients:
        - '#Everyone'
        - '#Java%20Lava'
      branches:
        only:
          - master
      on_success: always
      on_failure: always
